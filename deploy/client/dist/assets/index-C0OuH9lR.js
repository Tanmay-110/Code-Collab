import{j as e,r as i}from"./react-wZebJHc1.js";import{R as Ye}from"./react-dom-DT50qcZX.js";import{B as Je}from"./react-router-dom-LCIgetIK.js";import{I as $e,n as R,_ as k}from"./react-hot-toast-BWWCUkf6.js";import{l as We}from"./socket.io-client-pgtUPCnp.js";import{L as Ve,a as ee,b as Be,c as Xe,R as qe,d as Qe,e as Ke,A as Ze,f as et,P as we,M as Ce,T as tt,B as nt,g as ye,I as st,G as rt,h as ot,i as it,j as at,k as lt,l as ct,m as dt,n as ut,F as mt}from"./react-icons-10713ONO.js";import{v as _}from"./uuid-CtRu48qb.js";import{a as Ee}from"./axios-BtuGy7By.js";import{F as ft}from"./file-saver-B-MvsNKj.js";import{J as pt}from"./jszip-k2Kmrof5.js";import{h as ht,p as xt}from"./react-syntax-highlighter-C1i1g4qL.js";import{M as gt}from"./react-markdown-BugcatXE.js";import{I as bt}from"./vscode-icons-js-Chox8ZBA.js";import{I as Ne}from"./@iconify-xlv9DhMQ.js";import{c as M}from"./classnames-Nx13mCY7.js";import{l as ve}from"./lang-map-CUVzc_jb.js";import{x as wt,a as Ct,w as yt,b as Et,v as Nt,t as vt,c as jt,d as St,e as It,s as Dt,f as kt,g as Rt,r as Lt,q as Tt,o as Ot,n as Ft,h as At,m as Pt,i as _t,j as Ut,k as zt,l as Ht,p as Mt,u as Gt,y as Yt,z as Jt,A as $t,B as Wt,C as Vt,D as Bt,E as Xt,F as qt,G as Qt,H as Kt,I as Zt,J as en,K as tn,L as nn,M as sn,N as rn,O as on,P as an,Q as ln,R as cn,S as dn,T as un,U as mn,V as fn}from"./@uiw-DpTFFnQJ.js";import{A as pn}from"./react-avatar-BMjl9CdH.js";import{u as B,a as hn,b as je,c as xn,d as me}from"./react-router-CJPUFXGQ.js";import{S as gn}from"./react-split-vLuHrxa1.js";import{M as bn}from"./react-tooltip-BT3IPK-y.js";import{E as wn,bV as Cn,bW as yn,bX as En}from"./@codemirror-C_0nWpvc.js";import{s as fe}from"./screenfull-DmVOzVZz.js";import"./@babel-DCPa6niR.js";import"./scheduler-C323NY8X.js";import"./@remix-run-DaH1AUis.js";import"./goober-vt3s6TGe.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./refractor-Dtp-agq2.js";import"./hastscript-DoSH4Kmx.js";import"./property-information-BG6L-fdW.js";import"./xtend-VQg9yHl6.js";import"./hast-util-parse-selector-BXt8oe2z.js";import"./space-separated-tokens-D576Lxjb.js";import"./comma-separated-tokens-0S82Rvuq.js";import"./parse-entities-CHRgyl_4.js";import"./character-entities-legacy-Dg6o_FUQ.js";import"./character-reference-invalid-AKrgFUtc.js";import"./is-decimal-Bg2oiju0.js";import"./is-hexadecimal-yh8m6GRc.js";import"./is-alphanumerical-_oBzrqVk.js";import"./is-alphabetical-BQ1fjZEF.js";import"./devlop-Cl3hj7Sz.js";import"./unified-9NYyucGj.js";import"./bail-FqpXQuLt.js";import"./extend-EONt3pgD.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-tbz-BywF.js";import"./vfile-message-Bq256rVA.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-C8jcMe6G.js";import"./mdast-util-from-markdown-CgCUhJTR.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-DhRKOnvZ.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-CA-Wq7KA.js";import"./micromark-util-character-Ch8j4vtg.js";import"./micromark-core-commonmark-CDnWrFBr.js";import"./micromark-util-classify-character-GCpR5yWH.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-BC4BSQ9J.js";import"./micromark-factory-destination-CkgxUJuk.js";import"./micromark-factory-label-U15tx9Nh.js";import"./micromark-factory-title-reCpaPbc.js";import"./micromark-factory-whitespace-_v4v79HM.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-C7cpKZXR.js";import"./mdast-util-to-hast--qmxlI7R.js";import"./@ungap-DDJC10qW.js";import"./micromark-util-sanitize-uri-WGc3xW3f.js";import"./unist-util-position-60F3QETU.js";import"./trim-lines-D8znQY54.js";import"./unist-util-visit-C5MGqtgf.js";import"./unist-util-visit-parents-BC5uWo4u.js";import"./unist-util-is-D9KQvrmg.js";import"./hast-util-to-jsx-runtime-CjNrdjGD.js";import"./style-to-js-DBiDSDx-.js";import"./style-to-object-Oc--562q.js";import"./inline-style-parser-D4u_cg7q.js";import"./hast-util-whitespace-D4Wp6AEg.js";import"./estree-util-is-identifier-name-BgBfM8ME.js";import"./html-url-attributes-D46m5wfe.js";import"./@lezer-Csp4QB38.js";import"./codemirror-lang-mermaid-CD1uv0af.js";import"./@replit-9kcydoZv.js";import"./@nextjournal-UHV2LDqr.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./core-js-pure-CHhzCvfA.js";import"./prop-types-Buy-lEOz.js";import"./is-retina-BxxMYnvP.js";import"./md5-qfKjexc7.js";import"./crypt-VTvMai_Y.js";import"./charenc-DuOFFKym.js";import"./is-buffer-DMJNLjvk.js";import"./split.js-CPyVEc61.js";import"./@floating-ui-BeNuFGXj.js";import"./crelt-C8TCjufn.js";import"./style-mod-gVpFNjS1.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();function Nn(){return e.jsx($e,{position:"top-right"})}var V=(t=>(t.CODING="coding",t.DRAWING="drawing",t))(V||{}),W=(t=>(t.OFFLINE="offline",t.ONLINE="online",t))(W||{}),O=(t=>(t.INITIAL="initial",t.CONNECTING="connecting",t.ATTEMPTING_JOIN="attempting-join",t.JOINED="joined",t.CONNECTION_FAILED="connection-failed",t.DISCONNECTED="disconnected",t))(O||{});const Se=i.createContext(null),U=()=>{const t=i.useContext(Se);if(t===null)throw new Error("useAppContext must be used within a AppContextProvider");return t};function vn({children:t}){const[n,s]=i.useState([]),[r,o]=i.useState(O.INITIAL),[l,u]=i.useState({username:"",roomId:""}),[d,a]=i.useState(V.CODING),[c,x]=i.useState(null);return e.jsx(Se.Provider,{value:{users:n,setUsers:s,currentUser:l,setCurrentUser:u,status:r,setStatus:o,activityState:d,setActivityState:a,drawingData:c,setDrawingData:x},children:t})}var w=(t=>(t.JOIN_REQUEST="join-request",t.JOIN_ACCEPTED="join-accepted",t.USER_JOINED="user-joined",t.USER_DISCONNECTED="user-disconnected",t.SYNC_FILE_STRUCTURE="sync-file-structure",t.DIRECTORY_CREATED="directory-created",t.DIRECTORY_UPDATED="directory-updated",t.DIRECTORY_RENAMED="directory-renamed",t.DIRECTORY_DELETED="directory-deleted",t.FILE_CREATED="file-created",t.FILE_UPDATED="file-updated",t.FILE_RENAMED="file-renamed",t.FILE_DELETED="file-deleted",t.USER_OFFLINE="offline",t.USER_ONLINE="online",t.SEND_MESSAGE="send-message",t.RECEIVE_MESSAGE="receive-message",t.TYPING_START="typing-start",t.TYPING_PAUSE="typing-pause",t.USERNAME_EXISTS="username-exists",t.REQUEST_DRAWING="request-drawing",t.SYNC_DRAWING="sync-drawing",t.DRAWING_UPDATE="drawing-update",t))(w||{});const Ie=i.createContext(null),G=()=>{const t=i.useContext(Ie);if(!t)throw new Error("useSocket must be used within a SocketProvider");return t},jn="http://localhost:3000",Sn=({children:t})=>{const{users:n,setUsers:s,setStatus:r,setCurrentUser:o,drawingData:l,setDrawingData:u}=U(),d=i.useMemo(()=>We(jn,{reconnectionAttempts:2}),[]),a=i.useCallback(f=>{console.log("socket error",f),r(O.CONNECTION_FAILED),R.dismiss(),R.error("Failed to connect to the server")},[r]),c=i.useCallback(()=>{R.dismiss(),r(O.INITIAL),R.error("The username you chose already exists in the room. Please choose a different username.")},[r]),x=i.useCallback(({user:f,users:y})=>{o(f),s(y),R.dismiss(),r(O.JOINED),y.length>1&&R.loading("Syncing data, please wait...")},[o,r,s]),b=i.useCallback(({user:f})=>{R.success(`${f.username} left the room`),s(n.filter(y=>y.username!==f.username))},[s,n]),p=i.useCallback(({socketId:f})=>{d.emit(w.SYNC_DRAWING,{socketId:f,drawingData:l})},[l,d]),m=i.useCallback(({drawingData:f})=>{u(f)},[u]);return i.useEffect(()=>(d.on("connect_error",a),d.on("connect_failed",a),d.on(w.USERNAME_EXISTS,c),d.on(w.JOIN_ACCEPTED,x),d.on(w.USER_DISCONNECTED,b),d.on(w.REQUEST_DRAWING,p),d.on(w.SYNC_DRAWING,m),()=>{d.off("connect_error"),d.off("connect_failed"),d.off(w.USERNAME_EXISTS),d.off(w.JOIN_ACCEPTED),d.off(w.USER_DISCONNECTED),d.off(w.REQUEST_DRAWING),d.off(w.SYNC_DRAWING)}),[m,a,x,p,b,c,s,d]),e.jsx(Ie.Provider,{value:{socket:d},children:t})},De=i.createContext(null),te=()=>{const t=i.useContext(De);if(!t)throw new Error("useChatRoom must be used within a ChatContextProvider");return t};function In({children:t}){const{socket:n}=G(),[s,r]=i.useState([]),[o,l]=i.useState(!1),[u,d]=i.useState(0);return i.useEffect(()=>(n.on(w.RECEIVE_MESSAGE,({message:a})=>{r(c=>[...c,a]),l(!0)}),()=>{n.off(w.RECEIVE_MESSAGE)}),[n]),e.jsx(De.Provider,{value:{messages:s,setMessages:r,isNewMessage:o,setIsNewMessage:l,lastScrollHeight:u,setLastScrollHeight:d},children:t})}function Dn(t){const n=new Date(t);let s=n.getHours();const r=String(n.getMinutes()).padStart(2,"0"),o=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${r} ${o}`}function kn(){const{currentUser:t}=U(),{socket:n}=G(),{setMessages:s}=te(),r=i.useRef(null),o=l=>{var d;l.preventDefault();const u=(d=r.current)==null?void 0:d.value.trim();if(u&&u.length>0){const a={id:_(),message:u,username:t.username,timestamp:Dn(new Date().toISOString())};n.emit(w.SEND_MESSAGE,{message:a}),s(c=>[...c,a]),r.current&&(r.current.value="")}};return e.jsxs("form",{onSubmit:o,className:"flex justify-between rounded-md border border-primary",children:[e.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:r}),e.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:e.jsx(Ve,{size:24})})]})}function Rn(){const{messages:t,isNewMessage:n,setIsNewMessage:s,lastScrollHeight:r,setLastScrollHeight:o}=te(),{currentUser:l}=U(),u=i.useRef(null),d=a=>{const c=a.target;o(c.scrollTop)};return i.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[t]),i.useEffect(()=>{n&&s(!1),u.current&&(u.current.scrollTop=r)},[n,s,r]),e.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:u,onScroll:d,children:t.map((a,c)=>e.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(a.username===l.username?" ml-auto ":""),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-primary",children:a.username}),e.jsx("span",{className:"text-xs text-white",children:a.timestamp})]}),e.jsx("p",{className:"py-1",children:a.message})]},c))})}function X(){const[t,n]=i.useState({width:window.innerWidth,height:window.innerHeight}),[s,r]=i.useState(window.innerWidth<768);return i.useEffect(()=>{const o=()=>{n({width:window.innerWidth,height:window.innerHeight}),r(window.innerWidth<768)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),{...t,isMobile:s}}function A(){const[t,n]=i.useState(!1),{height:s,isMobile:r}=X(),[o,l]=i.useState(s);return i.useEffect(()=>{s<500&&r?(n(!0),l(s)):r?(n(!1),l(s-50)):(n(!1),l(s))},[s,r,o]),{viewHeight:o,minHeightReached:t}}const Ln=()=>{const{viewHeight:t}=A();return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:t},children:[e.jsx("h1",{className:"view-title",children:"Group Chat"}),e.jsx(Rn,{}),e.jsx(kn,{})]})},Tn="https://text.pollinations.ai",On=Ee.create({baseURL:Tn,headers:{"Content-Type":"application/json"}}),ke=i.createContext(null),Fn=()=>{const t=i.useContext(ke);if(t===null)throw new Error("useCopilot must be used within a CopilotContextProvider");return t},An=({children:t})=>{const[n,s]=i.useState(""),[r,o]=i.useState(""),[l,u]=i.useState(!1),d=async()=>{try{if(n.length===0){k.error("Please write a prompt");return}k.loading("Generating code..."),u(!0);const a=await On.post("/",{messages:[{role:"system",content:"You are a code generator copilot for project named Code Sync. Generate code based on the given prompt without any explanation. Return only the code, formatted in Markdown using the appropriate language syntax (e.g., js for JavaScript, py for Python). Do not include any additional text or explanations. If you don't know the answer, respond with 'I don't know'."},{role:"user",content:n}],model:"mistral",private:!0});if(a.data){k.success("Code generated successfully");const c=a.data;c&&o(c)}u(!1),k.dismiss()}catch(a){console.error(a),u(!1),k.dismiss(),k.error("Failed to generate the code")}};return e.jsx(ke.Provider,{value:{setInput:s,output:r,isRunning:l,generateCode:d},children:t})},Pn=`function sayHi() {
  console.log("👋 Hello world");
}

sayHi()`,_n={name:"root",id:_(),type:"directory",children:[{id:_(),type:"file",name:"index.js",content:Pn}]},Re=(t,n)=>{if(t.id===n&&t.type==="directory")return t;if(t.type==="directory"&&t.children)for(const s of t.children){const r=Re(s,n);if(r)return r}return null},pe=(t,n)=>t.children?t.children.some(s=>s.name===n):!1,Un=(t,n)=>{const s=r=>{if(r.id===n)return r;if(r.children)for(const o of r.children){const l=s(o);if(l)return l}return null};return s(t)},Le=t=>{if(t.type==="directory"&&t.children){let n=t.children.filter(r=>r.type==="directory");const s=t.children.filter(r=>r.type==="file");n.sort((r,o)=>r.name.localeCompare(o.name)),n=n.map(r=>Le(r)),s.sort((r,o)=>r.name.localeCompare(o.name)),t.children=[...n.filter(r=>r.name.startsWith(".")),...n.filter(r=>!r.name.startsWith(".")),...s.filter(r=>r.name.startsWith(".")),...s.filter(r=>!r.name.startsWith("."))]}return t},Te=i.createContext(null),H=()=>{const t=i.useContext(Te);if(!t)throw new Error("useFileSystem must be used within FileContextProvider");return t};function zn({children:t}){const{socket:n}=G(),{setUsers:s,drawingData:r}=U(),[o,l]=i.useState(_n),u=o.children?o.children:[],[d,a]=i.useState(u),[c,x]=i.useState(d[0]),b=h=>{const g=E=>E.id===h?{...E,isOpen:!E.isOpen}:E.children?{...E,children:E.children.map(g)}:E;l(E=>g(E))},p=()=>{const h=g=>{var E;return{...g,isOpen:!1,children:(E=g.children)==null?void 0:E.map(h)}};l(g=>h(g))},m=i.useCallback((h,g,E=!0)=>{let C;typeof g=="string"?C={id:_(),name:g,type:"directory",children:[],isOpen:!1}:C=g,h||(h=o.id);const v=j=>j.id===h?{...j,children:[...j.children||[],C]}:j.children?{...j,children:j.children.map(v)}:j;return l(j=>v(j)),E&&n.emit(w.DIRECTORY_CREATED,{parentDirId:h,newDirectory:C}),C.id},[o.id,n]),f=i.useCallback((h,g,E=!0)=>{h||(h=o.id);const C=v=>v.id===h?{...v,children:g}:v.children?{...v,children:v.children.map(C)}:v;l(v=>C(v)),a([]),x(null),h===o.id&&(R.dismiss(),R.success("Files and folders updated")),E&&n.emit(w.DIRECTORY_UPDATED,{dirId:h,children:g})},[o.id,n]),y=i.useCallback((h,g,E=!0)=>{const C=j=>j.type==="directory"&&j.children?j.children.some(I=>I.type==="directory"&&I.name===g&&I.id!==h)?null:{...j,children:j.children.map(I=>{if(I.id===h)return{...I,name:g};if(I.type==="directory"){const $=C(I);return $!==null?$:I}else return I})}:j,v=C(o);return v===null?!1:(l(v),E&&n.emit(w.DIRECTORY_RENAMED,{dirId:h,newDirName:g}),!0)},[n,l,o]),S=i.useCallback((h,g=!0)=>{const E=C=>{if(C.type==="directory"&&C.id===h)return null;if(C.children){const v=C.children.map(E).filter(j=>j!==null);return{...C,children:v}}else return C};l(C=>E(C)),g&&n.emit(w.DIRECTORY_DELETED,{dirId:h})},[n]),N=h=>{const g=Un(o,h);g&&(F((c==null?void 0:c.id)||"",(c==null?void 0:c.content)||""),d.some(E=>E.id===h)||a(E=>[...E,g]),a(E=>E.map(C=>C.id===(c==null?void 0:c.id)?{...C,content:c.content||""}:C)),x(g))},P=h=>{if(h===(c==null?void 0:c.id)){F(c.id,c.content||"");const g=d.findIndex(E=>E.id===h);g!==-1&&d.length>1?g>0?x(d[g-1]):x(d[g+1]):x(null)}a(g=>g.filter(E=>E.id!==h))},T=i.useCallback((h,g,E=!0)=>{let C=1;h||(h=o.id);const v=Re(o,h);if(!v)throw new Error("Parent directory not found");let j;if(typeof g=="string"){let I=g,$=pe(v,I);for(;$;)I=`${I.split(".")[0]}(${C}).${I.split(".")[1]}`,$=pe(v,I),C++;j={id:_(),name:I,type:"file",content:""}}else j=g;const K=I=>I.id===v.id?{...I,children:[...I.children||[],j],isOpen:!0}:I.children?{...I,children:I.children.map(K)}:I;return l(I=>K(I)),a(I=>[...I,j]),x(j),E&&n.emit(w.FILE_CREATED,{parentDirId:h,newFile:j}),j.id},[o,n]),F=i.useCallback((h,g)=>{const E=C=>C.type==="file"&&C.id===h?{...C,content:g}:C.children?{...C,children:C.children.map(E)}:C;l(C=>E(C)),d.some(C=>C.id===h)&&a(C=>C.map(v=>v.id===h?{...v,content:g}:v))},[d]),L=i.useCallback((h,g,E=!0)=>{const C=v=>v.type==="directory"&&v.children?{...v,children:v.children.map(j=>j.type==="file"&&j.id===h?{...j,name:g}:j)}:v;return l(v=>C(v)),a(v=>v.map(j=>j.id===h?{...j,name:g}:j)),h===(c==null?void 0:c.id)&&x(v=>v?{...v,name:g}:null),E&&n.emit(w.FILE_RENAMED,{fileId:h,newName:g}),!0},[c==null?void 0:c.id,n]),Y=i.useCallback((h,g=!0)=>{const E=C=>{if(C.type==="directory"&&C.children){const v=C.children.map(j=>j.type==="directory"?E(j):j.id!==h?j:null).filter(j=>j!==null);return{...C,children:v}}else return C};l(C=>E(C)),d.some(C=>C.id===h)&&a(C=>C.filter(v=>v.id!==h)),(c==null?void 0:c.id)===h&&x(null),R.success("File deleted successfully"),g&&n.emit(w.FILE_DELETED,{fileId:h})},[c==null?void 0:c.id,d,n]),Ge=()=>{const h=new pt,g=(E,C="")=>{const v=C+E.name+(E.type==="directory"?"/":"");if(E.type==="file")h.file(v,E.content||"");else if(E.type==="directory"&&E.children)for(const j of E.children)g(j,v)};if(o.type==="directory"&&o.children)for(const E of o.children)g(E);h.generateAsync({type:"blob"}).then(E=>{ft.saveAs(E,"download.zip")})},ne=i.useCallback(({user:h})=>{R.success(`${h.username} joined the room`),n.emit(w.SYNC_FILE_STRUCTURE,{fileStructure:o,openFiles:d,activeFile:c,socketId:h.socketId}),n.emit(w.SYNC_DRAWING,{drawingData:r,socketId:h.socketId}),s(g=>[...g,h])},[c,r,o,d,s,n]),se=i.useCallback(({fileStructure:h,openFiles:g,activeFile:E})=>{l(h),a(g),x(E),R.dismiss()},[]),re=i.useCallback(({parentDirId:h,newDirectory:g})=>{m(h,g,!1)},[m]),oe=i.useCallback(({dirId:h,children:g})=>{f(h,g,!1)},[f]),ie=i.useCallback(({dirId:h,newName:g})=>{y(h,g,!1)},[y]),ae=i.useCallback(({dirId:h})=>{S(h,!1)},[S]),le=i.useCallback(({parentDirId:h,newFile:g})=>{T(h,g,!1)},[T]),ce=i.useCallback(({fileId:h,newContent:g})=>{F(h,g),(c==null?void 0:c.id)===h&&x({...c,content:g})},[c,F]),de=i.useCallback(({fileId:h,newName:g})=>{L(h,g,!1)},[L]),ue=i.useCallback(({fileId:h})=>{Y(h,!1)},[Y]);return i.useEffect(()=>(n.once(w.SYNC_FILE_STRUCTURE,se),n.on(w.USER_JOINED,ne),n.on(w.DIRECTORY_CREATED,re),n.on(w.DIRECTORY_UPDATED,oe),n.on(w.DIRECTORY_RENAMED,ie),n.on(w.DIRECTORY_DELETED,ae),n.on(w.FILE_CREATED,le),n.on(w.FILE_UPDATED,ce),n.on(w.FILE_RENAMED,de),n.on(w.FILE_DELETED,ue),()=>{n.off(w.USER_JOINED),n.off(w.DIRECTORY_CREATED),n.off(w.DIRECTORY_UPDATED),n.off(w.DIRECTORY_RENAMED),n.off(w.DIRECTORY_DELETED),n.off(w.FILE_CREATED),n.off(w.FILE_UPDATED),n.off(w.FILE_RENAMED),n.off(w.FILE_DELETED)}),[re,ae,ie,oe,le,ue,de,se,ce,ne,n]),e.jsx(Te.Provider,{value:{fileStructure:o,openFiles:d,activeFile:c,setActiveFile:x,closeFile:P,toggleDirectory:b,collapseDirectories:p,createDirectory:m,updateDirectory:f,renameDirectory:y,deleteDirectory:S,openFile:N,createFile:T,updateFileContent:F,renameFile:L,deleteFile:Y,downloadFilesAndFolders:Ge},children:t})}function Hn(){const{socket:t}=G(),{viewHeight:n}=A(),{generateCode:s,output:r,isRunning:o,setInput:l}=Fn(),{activeFile:u,updateFileContent:d,setActiveFile:a}=H(),c=async()=>{try{const p=r.replace(/```[\w]*\n?/g,"").trim();await navigator.clipboard.writeText(p),k.success("Output copied to clipboard")}catch(p){k.error("Unable to copy output to clipboard"),console.log(p)}},x=()=>{if(u){const m=`${u.content?`${u.content}
`:""}${r.replace(/```[\w]*\n?/g,"").trim()}`;d(u.id,m),a({...u,content:m}),k.success("Code pasted successfully"),t.emit(w.FILE_UPDATED,{fileId:u.id,newContent:m})}},b=()=>{if(u){if(!confirm("Are you sure you want to replace the code in the file?"))return;const m=r.replace(/```[\w]*\n?/g,"").trim();d(u.id,m),a({...u,content:m}),k.success("Code replaced successfully"),t.emit(w.FILE_UPDATED,{fileId:u.id,newContent:m})}};return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:n},children:[e.jsx("h1",{className:"view-title",children:"Copilot"}),e.jsx("textarea",{className:"min-h-[120px] w-full rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"What code do you want to generate?",onChange:p=>l(p.target.value)}),e.jsx("button",{className:"mt-1 flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:s,disabled:o,children:o?"Generating...":"Generate Code"}),r&&e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{title:"Copy Output",onClick:c,children:e.jsx(ee,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Replace code in file",onClick:b,children:e.jsx(Be,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Paste code in file",onClick:x,children:e.jsx(Xe,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"h-full rounded-lg w-full overflow-y-auto p-0",children:e.jsx(gt,{components:{code({inline:p,className:m,children:f,...y}){const S=/language-(\w+)/.exec(m||""),N=S?S[1]:"javascript";return p?e.jsx("code",{className:m,...y,children:f}):e.jsx(ht,{style:xt.dracula,language:N,PreTag:"pre",className:"!m-0 !h-full !rounded-lg !bg-gray-900 !p-2",children:String(f).replace(/\n$/,"")})},pre({children:p}){return e.jsx("pre",{className:"h-full",children:p})}},children:r})})]})}const Oe=({ref:t})=>{const[n,s]=i.useState(!1),[r,o]=i.useState({x:0,y:0});return i.useEffect(()=>{const l=t.current;if(!l)return;const u=()=>{s(!1)},d=c=>{t.current&&t.current.contains(c.target)?(s(!0),o({x:c.pageX,y:c.pageY})):s(!1)},a=c=>{c.preventDefault(),s(!0),o({x:c.pageX,y:c.pageY})};return l.addEventListener("contextmenu",a),document.addEventListener("click",u),document.addEventListener("contextmenu",d),()=>{l.removeEventListener("contextmenu",a),document.removeEventListener("click",u),document.removeEventListener("contextmenu",d)}},[t]),{menuOpen:n,setMenuOpen:s,coords:r,setCoords:o}},Fe=t=>{var r;return`vscode-icons:${(r=bt.getIconForFile(t))==null?void 0:r.replace(/_/g,"-").split(".")[0]}`};function Ae({id:t,preName:n,setEditing:s,type:r}){const[o,l]=i.useState(n||""),{renameFile:u,openFile:d,renameDirectory:a}=H(),c=i.useRef(null),x=m=>{m.preventDefault(),m.stopPropagation();const f=r.charAt(0).toUpperCase()+r.slice(1);if(o==="")k.error(`${f} name cannot be empty`);else if(o.length>25)k.error(`${f} name cannot be longer than 25 characters`);else if(o===n)k.error(`${f} name cannot be the same as before`);else{const y=r==="directory"?a(t,o):u(t,o);y&&r==="file"&&d(t),y?s(!1):k.error(`${f} with same name already exists`)}},b=i.useCallback(m=>{var f;m.key==="Enter"?(f=c.current)==null||f.requestSubmit():m.key==="Escape"&&s(!1)},[s]),p=i.useCallback(m=>{const f=c.current;f&&!f.contains(m.target)&&s(!1)},[s]);return i.useEffect(()=>{const m=c.current;if(m)return m.focus(),m.addEventListener("keydown",b),document.addEventListener("keydown",p),document.addEventListener("click",p),()=>{m.removeEventListener("keydown",b),document.removeEventListener("keydown",p),document.removeEventListener("click",p)}},[p,b,s]),e.jsx("div",{className:"rounded-md",children:e.jsx("form",{onSubmit:x,ref:c,className:"flex w-full items-center gap-2 rounded-md",children:e.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:o,onChange:m=>l(m.target.value)})})})}function Mn(){const{fileStructure:t,createFile:n,createDirectory:s,collapseDirectories:r}=H(),o=i.useRef(null),[l,u]=i.useState(null),{minHeightReached:d}=A(),a=p=>{o.current&&!o.current.contains(p.target)&&u(t.id)},c=()=>{const p=prompt("Enter file name");if(p){const m=l||t.id;n(m,p)}},x=()=>{const p=prompt("Enter directory name");if(p){const m=l||t.id;s(m,p)}},b=Le(t);return e.jsxs("div",{onClick:a,className:"flex flex-grow flex-col",children:[e.jsxs("div",{className:"view-title flex justify-between",children:[e.jsx("h2",{children:"Files"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:c,title:"Create File",children:e.jsx(qe,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:x,title:"Create Directory",children:e.jsx(Qe,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:r,title:"Collapse All Directories",children:e.jsx(Ke,{size:20})})]})]}),e.jsx("div",{className:M("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!d,"h-[85vh]":d}),ref:o,children:b.children&&b.children.map(p=>e.jsx(Pe,{item:p,setSelectedDirId:u},p.id))})]})}function Pe({item:t,setSelectedDirId:n}){const[s,r]=i.useState(!1),o=i.useRef(null),{coords:l,menuOpen:u,setMenuOpen:d}=Oe({ref:o}),{deleteDirectory:a,toggleDirectory:c}=H(),x=m=>{n(m),c(m)},b=m=>{m.stopPropagation(),d(!1),r(!0)},p=(m,f)=>{m.stopPropagation(),d(!1),confirm("Are you sure you want to delete directory?")&&a(f)};return i.useEffect(()=>{const m=o.current;if(!m)return;m.tabIndex=0;const f=y=>{y.stopPropagation(),y.key==="F2"&&r(!0)};return m.addEventListener("keydown",f),()=>{m.removeEventListener("keydown",f)}},[]),t.type==="file"?e.jsx(Gn,{item:t,setSelectedDirId:n}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>x(t.id),ref:o,children:[t.isOpen?e.jsx(Ze,{size:24,className:"mr-2 min-w-fit"}):e.jsx(et,{size:24,className:"mr-2 min-w-fit"}),s?e.jsx(Ae,{id:t.id,preName:t.name,type:"directory",setEditing:r}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name})]}),e.jsx("div",{className:M({hidden:!t.isOpen},{block:t.isOpen},{"pl-4":t.name!=="root"}),children:t.children&&t.children.map(m=>e.jsx(Pe,{item:m,setSelectedDirId:n},m.id))}),u&&e.jsx(Jn,{handleDeleteDirectory:p,handleRenameDirectory:b,id:t.id,left:l.x,top:l.y})]})}const Gn=({item:t,setSelectedDirId:n})=>{const{deleteFile:s,openFile:r}=H(),[o,l]=i.useState(!1),{setIsSidebarOpen:u}=Q(),{isMobile:d}=X(),{activityState:a,setActivityState:c}=U(),x=i.useRef(null),{menuOpen:b,coords:p,setMenuOpen:m}=Oe({ref:x}),f=N=>{o||(n(N),r(N),d&&u(!1),a===V.DRAWING&&c(V.CODING))},y=N=>{N.stopPropagation(),l(!0),m(!1)},S=(N,P)=>{N.stopPropagation(),m(!1),confirm("Are you sure you want to delete file?")&&s(P)};return i.useEffect(()=>{const N=x.current;if(!N)return;N.tabIndex=0;const P=T=>{T.stopPropagation(),T.key==="F2"&&l(!0)};return N.addEventListener("keydown",P),()=>{N.removeEventListener("keydown",P)}},[]),e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>f(t.id),ref:x,children:[e.jsx(Ne,{icon:Fe(t.name),fontSize:22,className:"mr-2 min-w-fit"}),o?e.jsx(Ae,{id:t.id,preName:t.name,type:"file",setEditing:l}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name}),b&&e.jsx(Yn,{top:p.y,left:p.x,id:t.id,handleRenameFile:y,handleDeleteFile:S})]})},Yn=({top:t,left:n,id:s,handleRenameFile:r,handleDeleteFile:o})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:n},children:[e.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(we,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>o(l,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(Ce,{size:20}),"Delete"]})]}),Jn=({top:t,left:n,id:s,handleRenameDirectory:r,handleDeleteDirectory:o})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:n},children:[e.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(we,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>o(l,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(Ce,{size:20}),"Delete"]})]});function $n(){const{downloadFilesAndFolders:t,updateDirectory:n}=H(),{viewHeight:s}=A(),{minHeightReached:r}=A(),[o,l]=i.useState(!1),u=async()=>{try{if(l(!0),"showDirectoryPicker"in window){const b=await window.showDirectoryPicker();await d(b);return}if("webkitdirectory"in HTMLInputElement.prototype){const b=document.createElement("input");b.type="file",b.webkitdirectory=!0,b.onchange=async p=>{const m=p.target.files;if(m){const f=await c(m);n("",f)}},b.click();return}R.error("Your browser does not support directory selection.")}catch(b){console.error("Error opening directory:",b),R.error("Failed to open directory")}finally{l(!1)}},d=async b=>{try{R.loading("Getting files and folders...");const p=await a(b);n("",p),R.dismiss(),R.success("Directory loaded successfully")}catch(p){console.error("Error processing directory:",p),R.error("Failed to process directory")}},a=async b=>{const p=[],m=["node_modules",".git",".vscode",".next"];for await(const f of b.values())if(f.kind==="file"){const y=await f.getFile(),S={id:_(),name:f.name,type:"file",content:await x(y)};p.push(S)}else if(f.kind==="directory"){if(m.includes(f.name))continue;const y={id:_(),name:f.name,type:"directory",children:await a(f),isOpen:!1};p.push(y)}return p},c=async b=>{const p=[],m=["node_modules",".git",".vscode",".next"];for(let f=0;f<b.length;f++){const y=b[f],S=y.webkitRelativePath.split("/");if(!S.some(N=>m.includes(N)))if(S.length>1){const N=S.slice(0,-1).join("/");if(p.findIndex(L=>L.name===N&&L.type==="directory")===-1){const L={id:_(),name:N,type:"directory",children:[],isOpen:!1};p.push(L)}const T={id:_(),name:y.name,type:"file",content:await x(y)},F=p.find(L=>L.name===N&&L.type==="directory");F&&F.children&&F.children.push(T)}else{const N={id:_(),name:y.name,type:"file",content:await x(y)};p.push(N)}}return p},x=async b=>{if(b.size>1048576)return`File too large: ${b.name} (${Math.round(b.size/1024)}KB)`;try{return await b.text()}catch(m){return console.error(`Error reading file ${b.name}:`,m),`Error reading file: ${b.name}`}};return e.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:s,maxHeight:s},children:[e.jsx(Mn,{}),e.jsxs("div",{className:M("flex min-h-fit flex-col justify-end pt-2",{hidden:r}),children:[e.jsx("hr",{}),e.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:u,disabled:o,children:[e.jsx(tt,{className:"mr-2",size:24}),o?"Loading...":"Open File/Folder"]}),e.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:t,children:[e.jsx(nt,{className:"mr-2",size:22})," Download Code"]})]})]})}const Wn="https://emkc.org/api/v2/piston",he=Ee.create({baseURL:Wn,headers:{"Content-Type":"application/json"}}),_e=i.createContext(null),Vn=()=>{const t=i.useContext(_e);if(t===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return t},Bn=({children:t})=>{const{activeFile:n}=H(),[s,r]=i.useState(""),[o,l]=i.useState(""),[u,d]=i.useState(!1),[a,c]=i.useState([]),[x,b]=i.useState({language:"",version:"",aliases:[]});i.useEffect(()=>{(async()=>{var f,y;try{const S=await he.get("/runtimes");c(S.data)}catch(S){k.error("Failed to fetch supported languages"),(f=S==null?void 0:S.response)!=null&&f.data&&console.error((y=S==null?void 0:S.response)==null?void 0:y.data)}})()},[]),i.useEffect(()=>{if(a.length===0||!(n!=null&&n.name))return;const m=n.name.split(".").pop();if(m){const f=ve.languages(m),y=a.find(S=>S.aliases.includes(m)||f.includes(S.language.toLowerCase()));y&&b(y)}else b({language:"",version:"",aliases:[]})},[n==null?void 0:n.name,a]);const p=async()=>{try{if(x)if(n)k.loading("Running code...");else return k.error("Please open a file to run the code");else return k.error("Please select a language to run the code");d(!0);const{language:m,version:f}=x,y=await he.post("/execute",{language:m,version:f,files:[{name:n.name,content:n.content}],stdin:s});y.data.run.stderr?l(y.data.run.stderr):l(y.data.run.stdout),d(!1),k.dismiss()}catch(m){console.error(m.response.data),console.error(m.response.data.error),d(!1),k.dismiss(),k.error("Failed to run the code")}};return e.jsx(_e.Provider,{value:{setInput:r,output:o,isRunning:u,supportedLanguages:a,selectedLanguage:x,setSelectedLanguage:b,runCode:p},children:t})};function Xn(){const{viewHeight:t}=A(),{setInput:n,output:s,isRunning:r,supportedLanguages:o,selectedLanguage:l,setSelectedLanguage:u,runCode:d}=Vn(),a=x=>{const b=JSON.parse(x.target.value);u(b)},c=()=>{navigator.clipboard.writeText(s),k.success("Output copied to clipboard")};return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:t},children:[e.jsx("h1",{className:"view-title",children:"Run Code"}),e.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(l),onChange:a,children:o.sort((x,b)=>x.language>b.language?1:-1).map((x,b)=>e.jsx("option",{value:JSON.stringify(x),children:x.language+(x.version?` (${x.version})`:"")},b))}),e.jsx(ye,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),e.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:x=>n(x.target.value)}),e.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:d,disabled:r,children:"Run"}),e.jsxs("label",{className:"flex w-full justify-between",children:["Output :",e.jsx("button",{onClick:c,title:"Copy Output",children:e.jsx(ee,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:e.jsx("code",{children:e.jsx("pre",{className:"text-wrap",children:s})})})]})]})}function Z({onChange:t,value:n,options:s,title:r}){return e.jsxs("div",{className:"relative w-full",children:[e.jsx("label",{className:"mb-2",children:r}),e.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:n,onChange:t,children:s.sort().map(o=>{const l=o,u=o.charAt(0).toUpperCase()+o.slice(1);return e.jsx("option",{value:l,children:u},u)})}),e.jsx(ye,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]})}function Ue(){return{setItem:(r,o)=>{localStorage.setItem(r,o)},getItem:r=>localStorage.getItem(r),removeItem:r=>{localStorage.removeItem(r)}}}const ze=i.createContext(null),q=()=>{const t=i.useContext(ze);if(!t)throw new Error("useSettings must be used within a SettingContextProvider");return t},z={theme:"GitHub Dark",language:"Javascript",fontSize:14,fontFamily:"JetBrains Mono",showGitHubCorner:!0};function qn({children:t}){const{getItem:n}=Ue(),s=JSON.parse(n("settings")||"{}"),r=s.theme!==void 0?s.theme:z.theme,o=s.language!==void 0?s.language:z.language,l=s.fontSize!==void 0?s.fontSize:z.fontSize,u=s.fontFamily!==void 0?s.fontFamily:z.fontFamily,d=s.showGitHubCorner!==void 0?s.showGitHubCorner:z.showGitHubCorner,[a,c]=i.useState(r),[x,b]=i.useState(o),[p,m]=i.useState(l),[f,y]=i.useState(u),[S,N]=i.useState(d),P=()=>{c(z.theme),b(z.language),m(z.fontSize),y(z.fontFamily),N(z.showGitHubCorner)};return i.useEffect(()=>{const T={theme:a,language:x,fontSize:p,fontFamily:f,showGitHubCorner:S};localStorage.setItem("settings",JSON.stringify(T))},[a,x,p,f,S]),e.jsx(ze.Provider,{value:{theme:a,setTheme:c,language:x,setLanguage:b,fontSize:p,setFontSize:m,fontFamily:f,setFontFamily:y,showGitHubCorner:S,setShowGitHubCorner:N,resetSettings:P},children:t})}const Qn=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],He={Abcdef:ln,Abyss:an,"Android Studio":on,Andromeda:rn,"Atom One":sn,Aura:nn,"Basic Dark":tn,"Basic Light":en,BBEdit:Zt,Bespin:Kt,Copilot:Qt,Darcula:qt,Dracula:Xt,"Duotone Dark":Bt,"Duotone Light":Vt,Eclipse:Wt,"GitHub Dark":$t,"GitHub Light":Jt,"Gruvbox Dark":Yt,"Gruvbox Light":Gt,Kimbie:Mt,Material:Ht,"Material Dark":zt,"Material Light":Ut,Monokai:_t,"Monokai Dimmed":Pt,"Noctis Lilac":At,Nord:Ft,Okaidia:Ot,"Quiet Light":Tt,Red:Lt,"Solarized Dark":Rt,"Solarized Light":kt,Sublime:Dt,"Tokyo Night":It,"Tokyo Night Day":St,"Tokyo Night Storm":jt,"Tomorrow Night Blue":vt,"VS Code Dark":Nt,"White Dark":Et,"White Light":yt,"Xcode Dark":Ct,"Xcode Light":wt};function Kn(){const{theme:t,setTheme:n,language:s,setLanguage:r,fontSize:o,setFontSize:l,fontFamily:u,setFontFamily:d,showGitHubCorner:a,setShowGitHubCorner:c,resetSettings:x}=q(),{viewHeight:b}=A(),p=N=>d(N.target.value),m=N=>n(N.target.value),f=N=>r(N.target.value),y=N=>l(parseInt(N.target.value)),S=N=>c(N.target.checked);return i.useEffect(()=>{const N=document.querySelector(".cm-editor > .cm-scroller");N!==null&&(N.style.fontFamily=`${u}, monospace`)},[u]),e.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:b},children:[e.jsx("h1",{className:"view-title",children:"Settings"}),e.jsxs("div",{className:"flex w-full items-end gap-2",children:[e.jsx(Z,{onChange:p,value:u,options:Qn,title:"Font Family"}),e.jsx("select",{value:o,onChange:y,className:"rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",title:"Font Size",children:[...Array(13).keys()].map(N=>e.jsx("option",{value:N+12,children:N+12},N))})]}),e.jsx(Z,{onChange:m,value:t,options:Object.keys(He),title:"Theme"}),e.jsx(Z,{onChange:f,value:s,options:cn,title:"Language"}),e.jsxs("div",{className:"mt-4 flex w-full items-center justify-between",children:[e.jsx("label",{children:"Show github corner"}),e.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[e.jsx("input",{className:"peer sr-only",type:"checkbox",onChange:S,checked:a}),e.jsx("div",{className:"peer h-6 w-12 rounded-full bg-darkHover outline-none duration-100 after:absolute after:left-1 after:top-1 after:flex after:h-4 after:w-4 after:items-center after:justify-center after:rounded-full after:bg-white after:font-bold after:outline-none after:duration-500 peer-checked:after:translate-x-6 peer-checked:after:border-white peer-focus:outline-none"})]})]}),e.jsx("button",{className:"mt-auto w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",onClick:x,children:"Reset to default"})]})}function Zn(){const{users:t}=U();return e.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:e.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6",children:t.map(n=>e.jsx(es,{user:n},n.socketId))})})}const es=({user:t})=>{const{username:n,status:s}=t,r=`${n} - ${s===W.ONLINE?"online":"offline"}`;return e.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",title:r,children:[e.jsx(pn,{name:n,size:"50",round:"12px",title:r}),e.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words",children:n}),e.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${s===W.ONLINE?"bg-green-500":"bg-danger"}`})]})};function ts(){const t=B(),{viewHeight:n}=A(),{setStatus:s}=U(),{socket:r}=G(),o=async()=>{const d=window.location.href;try{await navigator.clipboard.writeText(d),k.success("URL copied to clipboard")}catch(a){k.error("Unable to copy URL to clipboard"),console.log(a)}},l=async()=>{const d=window.location.href;try{await navigator.share({url:d})}catch(a){k.error("Unable to share URL"),console.log(a)}},u=()=>{r.disconnect(),s(O.DISCONNECTED),t("/",{replace:!0})};return e.jsxs("div",{className:"flex flex-col p-4",style:{height:n},children:[e.jsx("h1",{className:"view-title",children:"Users"}),e.jsx(Zn,{}),e.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:l,title:"Share Link",children:e.jsx(st,{size:26})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:o,title:"Copy Link",children:e.jsx(ee,{size:22})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:u,title:"Leave room",children:e.jsx(rt,{size:22})})]})})]})}var D=(t=>(t.FILES="FILES",t.CHATS="CHATS",t.CLIENTS="CLIENTS",t.RUN="RUN",t.COPILOT="COPILOT",t.SETTINGS="SETTINGS",t))(D||{});const Me=i.createContext(null),Q=()=>{const t=i.useContext(Me);if(!t)throw new Error("useViews must be used within a ViewContextProvider");return t};function ns({children:t}){const{isMobile:n}=X(),[s,r]=i.useState(D.FILES),[o,l]=i.useState(!n),[u]=i.useState({[D.FILES]:e.jsx($n,{}),[D.CLIENTS]:e.jsx(ts,{}),[D.SETTINGS]:e.jsx(Kn,{}),[D.COPILOT]:e.jsx(Hn,{}),[D.CHATS]:e.jsx(Ln,{}),[D.RUN]:e.jsx(Xn,{})}),[d]=i.useState({[D.FILES]:e.jsx(dt,{size:28}),[D.CLIENTS]:e.jsx(ct,{size:30}),[D.SETTINGS]:e.jsx(lt,{size:28}),[D.CHATS]:e.jsx(at,{size:30}),[D.COPILOT]:e.jsx(it,{size:28}),[D.RUN]:e.jsx(ot,{size:28})});return e.jsx(Me.Provider,{value:{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:l,viewComponents:u,viewIcons:d},children:t})}function ss({children:t}){const{isSidebarOpen:n}=Q(),{isMobile:s,width:r}=X(),{setItem:o,getItem:l}=Ue(),u=()=>{const p=document.createElement("div");return p.className="h-full cursor-e-resizer hidden md:block",p.style.backgroundColor="#e1e1ffb3",p},d=()=>{if(s)return[0,r];const p=l("editorSizes");let m=[35,65];return p&&(m=JSON.parse(p)),n?m:[0,r]},a=()=>s?[0,r]:n?[350,350]:[50,0],c=()=>s?[0,1/0]:n?[1/0,1/0]:[0,1/0],x=p=>{o("editorSizes",JSON.stringify(p))},b=()=>({width:"7px",display:n&&!s?"block":"none"});return e.jsx(gn,{sizes:d(),minSize:a(),gutter:u,maxSize:c(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:b,onDrag:x,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:t})}function rs(){return e.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:e.jsx(os,{})})}const os=()=>{const t=B(),n=()=>{window.location.reload()},s=()=>{t("/")};return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:n,children:"Try Again"}),e.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Go to HomePage"})]})]})},is={backgroundColor:"#e0e0e0",padding:"8px 12px",borderRadius:"6px",color:"#000",fontSize:"12px",fontWeight:"500",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},xe={base:"relative flex items-center justify-center rounded transition-colors duration-200 ease-in-out p-2",hover:"hover:bg-[#3D404A]"},J=({viewName:t,icon:n})=>{const{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:l}=Q(),{isNewMessage:u}=te(),[d,a]=i.useState(!0),c=x=>{x===s?l(!o):(l(!0),r(x))};return e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>c(t),onMouseEnter:()=>a(!0),className:`${xe.base} ${xe.hover}`,...d&&{"data-tooltip-id":`tooltip-${t}`,"data-tooltip-content":t},children:[e.jsx("div",{className:"flex items-center justify-center",children:n}),t===D.CHATS&&u&&e.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]}),d&&e.jsx(bn,{id:`tooltip-${t}`,place:"right",offset:25,className:"!z-50",style:is,noArrow:!1,positionStrategy:"fixed",float:!0})]})};function as(){const{activeView:t,isSidebarOpen:n,viewComponents:s,viewIcons:r}=Q(),{minHeightReached:o}=A();return e.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[e.jsxs("div",{className:M("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-4 self-end overflow-hidden border-t border-darkHover bg-dark p-2 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:o}),children:[e.jsx(J,{viewName:D.FILES,icon:r[D.FILES]}),e.jsx(J,{viewName:D.CHATS,icon:r[D.CHATS]}),e.jsx(J,{viewName:D.COPILOT,icon:r[D.COPILOT]}),e.jsx(J,{viewName:D.RUN,icon:r[D.RUN]}),e.jsx(J,{viewName:D.CLIENTS,icon:r[D.CLIENTS]}),e.jsx(J,{viewName:D.SETTINGS,icon:r[D.SETTINGS]})]}),e.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-col bg-dark md:static md:min-w-[300px]",style:n?{}:{display:"none"},children:s[t]})]})}function ls(){const{fontSize:t,setFontSize:n}=q();i.useEffect(()=>{const s=r=>{const o="Changes you made may not be saved";return r.returnValue=o};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),i.useEffect(()=>{const s=r=>{if(r.ctrlKey){if(r.preventDefault(),!r.target.closest(".cm-editor"))return;r.deltaY>0?n(Math.max(t-1,12)):n(Math.min(t+1,24))}};return window.addEventListener("wheel",s,{passive:!1}),()=>{window.removeEventListener("wheel",s)}},[t,n])}function cs(t){return Cn.define({create:()=>ge(t),update(n,s){return!s.docChanged&&!s.selection?n:ge(t)},provide:n=>yn.computeN([n],s=>s.field(n))})}function ge(t){return t.map(n=>{if(!n.typing)return null;let s=n.username;const r=n.cursorPosition;return n&&(s=n.username),{pos:r,above:!0,strictSide:!0,arrow:!0,create:()=>{const o=document.createElement("div");return o.className="cm-tooltip-cursor",o.textContent=s,{dom:o}}}})}const ds=wn.baseTheme({".cm-tooltip.cm-tooltip-cursor":{backgroundColor:"#66b",color:"white",border:"none",padding:"2px 7px",borderRadius:"4px",zIndex:"10","& .cm-tooltip-arrow:before":{borderTopColor:"#66b"},"& .cm-tooltip-arrow:after":{borderTopColor:"transparent"}}});function us(){const{users:t,currentUser:n}=U(),{activeFile:s,setActiveFile:r}=H(),{theme:o,language:l,fontSize:u}=q(),{socket:d}=G(),{viewHeight:a}=A(),[c,x]=i.useState(setTimeout(()=>{},0)),b=i.useMemo(()=>t.filter(y=>y.username!==n.username),[t,n]),[p,m]=i.useState([]),f=(y,S)=>{var F,L,Y;if(!s)return;const N={...s,content:y};r(N);const P=(Y=(L=(F=S.state)==null?void 0:F.selection)==null?void 0:L.main)==null?void 0:Y.head;d.emit(w.TYPING_START,{cursorPosition:P}),d.emit(w.FILE_UPDATED,{fileId:s.id,newContent:y}),clearTimeout(c);const T=setTimeout(()=>d.emit(w.TYPING_PAUSE),1e3);x(T)};return ls(),i.useEffect(()=>{const y=[dn,un,cs(b),ds,En()],S=mn(l.toLowerCase());S?y.push(S):k.error("Syntax highlighting is unavailable for this language. Please adjust the editor settings; it may be listed under a different name.",{duration:5e3}),m(y)},[b,l]),e.jsx(fn,{theme:He[o],onChange:f,value:s==null?void 0:s.content,extensions:p,minHeight:"100%",maxWidth:"100vw",style:{fontSize:u+"px",height:a,position:"relative"}})}const be={php:"php",cs:"csharp"};function ms(){const{openFiles:t,closeFile:n,activeFile:s,updateFileContent:r,setActiveFile:o}=H(),l=i.useRef(null),{setLanguage:u}=q(),d=a=>{if((s==null?void 0:s.id)===a)return;r((s==null?void 0:s.id)||"",(s==null?void 0:s.content)||"");const c=t.find(x=>x.id===a);c&&o(c)};return i.useEffect(()=>{const a=l.current;if(!a)return;const c=x=>{x.deltaY>0?a.scrollLeft+=100:a.scrollLeft-=100};return a.addEventListener("wheel",c),()=>{a.removeEventListener("wheel",c)}},[]),i.useEffect(()=>{if((s==null?void 0:s.name)===void 0)return;const a=s.name.split(".").pop();if(!a)return;if(be[a]){u(be[a]);return}const c=ve.languages(a);u(c[0])},[s==null?void 0:s.name,u]),e.jsx("div",{className:"flex h-[50px] w-full select-none gap-1 overflow-x-auto bg-[#0d1117] px-2 pt-2",ref:l,children:t.map(a=>e.jsxs("div",{className:M("group flex w-fit cursor-pointer items-center rounded-t-md border border-b-0 px-3 py-1.5 transition-all duration-200",{"border-[#30363d] bg-[#161b22]":a.id===(s==null?void 0:s.id),"border-transparent hover:border-[#30363d] hover:bg-[#161b22]/50":a.id!==(s==null?void 0:s.id)}),onClick:()=>d(a.id),children:[e.jsx(Ne,{icon:Fe(a.name),fontSize:18,className:M("mr-2 min-w-fit transition-colors duration-200",{"text-[#58a6ff]":a.id===(s==null?void 0:s.id),"text-[#8b949e] group-hover:text-[#c9d1d9]":a.id!==(s==null?void 0:s.id)})}),e.jsx("p",{className:M("flex-grow cursor-pointer overflow-hidden truncate text-sm transition-colors duration-200",{"text-[#c9d1d9]":a.id===(s==null?void 0:s.id),"text-[#8b949e] group-hover:text-[#c9d1d9]":a.id!==(s==null?void 0:s.id)}),title:a.name,children:a.name}),e.jsx(ut,{className:M("ml-2 inline rounded-md p-0.5 transition-colors duration-200",{"text-[#8b949e] hover:bg-[#30363d] hover:text-[#c9d1d9]":a.id===(s==null?void 0:s.id),"text-[#6e7681] hover:bg-[#30363d] hover:text-[#c9d1d9]":a.id!==(s==null?void 0:s.id)}),size:18,onClick:c=>{c.stopPropagation(),n(a.id)}})]},a.id))})}function fs(){const{openFiles:t}=H(),{minHeightReached:n}=A();return t.length<=0?e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center bg-gray-800 p-8",children:[e.jsx("div",{className:"mb-4 text-gray-400",children:e.jsx("svg",{className:"h-16 w-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-300",children:"No file is currently open"}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Open a file to start editing"})]}):e.jsxs("main",{className:M("flex w-full flex-col overflow-x-auto bg-gray-800 md:h-screen",{"h-[calc(100vh-50px)]":!n,"h-full":n}),children:[e.jsx("div",{className:"border-b border-gray-700 bg-gray-800",children:e.jsx(ms,{})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(us,{})})]})}function ps(){const{viewHeight:t}=A();return e.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden bg-[#0d1117] md:static",style:{height:t},children:e.jsx("div",{className:"h-full w-full rounded-lg border border-[#30363d] bg-[#0d1117] shadow-lg",children:e.jsx(fs,{})})})}function hs(){function t(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(r=>navigator.userAgent.match(r))}const n=t();i.useEffect(()=>{n&&fe.isEnabled&&fe.request()},[n])}function xs(){const{setUsers:t}=U(),{socket:n}=G(),s=i.useCallback(()=>{document.visibilityState==="visible"?n.emit(w.USER_ONLINE,{socketId:n.id}):document.visibilityState==="hidden"&&n.emit(w.USER_OFFLINE,{socketId:n.id})},[n]),r=i.useCallback(({socketId:u})=>{t(d=>d.map(a=>a.socketId===u?{...a,status:W.ONLINE}:a))},[t]),o=i.useCallback(({socketId:u})=>{t(d=>d.map(a=>a.socketId===u?{...a,status:W.OFFLINE}:a))},[t]),l=i.useCallback(({user:u})=>{t(d=>d.map(a=>a.socketId===u.socketId?u:a))},[t]);i.useEffect(()=>(document.addEventListener("visibilitychange",s),n.on(w.USER_ONLINE,r),n.on(w.USER_OFFLINE,o),n.on(w.TYPING_START,l),n.on(w.TYPING_PAUSE,l),()=>{document.removeEventListener("visibilitychange",s),n.off(w.USER_ONLINE),n.off(w.USER_OFFLINE),n.off(w.TYPING_START),n.off(w.TYPING_PAUSE)}),[n,t,s,r,o,l])}function gs(){var d;xs(),hs();const t=B(),{roomId:n}=hn(),{status:s,setCurrentUser:r,currentUser:o}=U(),{socket:l}=G(),u=je();return i.useEffect(()=>{var c;if(o.username.length>0)return;const a=(c=u.state)==null?void 0:c.username;if(a===void 0)t("/",{state:{roomId:n}});else if(n){const x={username:a,roomId:n};r(x),l.emit(w.JOIN_REQUEST,x)}},[o.username,(d=u.state)==null?void 0:d.username,t,n,r,l]),s===O.CONNECTION_FAILED?e.jsx(rs,{}):e.jsxs(ss,{children:[e.jsx(as,{}),e.jsx(ps,{})]})}const bs=()=>{var p,m;const t=je(),{currentUser:n,setCurrentUser:s,status:r,setStatus:o}=U(),{socket:l}=G(),u=i.useRef(null),d=B(),a=()=>{var f;s({...n,roomId:_()}),R.success("Created a new Room ID"),(f=u.current)==null||f.focus()},c=f=>{const y=f.target.name,S=f.target.value;s({...n,[y]:S})},x=()=>n.username.trim().length===0?(R.error("Enter your username"),!1):n.roomId.trim().length===0?(R.error("Enter a room ID"),!1):n.roomId.trim().length<5?(R.error("Room ID must be at least 5 characters long"),!1):n.username.trim().length<3?(R.error("Username must be at least 3 characters long"),!1):!0,b=f=>{f.preventDefault(),r!==O.ATTEMPTING_JOIN&&x()&&(R.loading("Joining room..."),o(O.ATTEMPTING_JOIN),l.emit(w.JOIN_REQUEST,n))};return i.useEffect(()=>{var f;n.roomId.length>0||(f=t.state)!=null&&f.roomId&&(s({...n,roomId:t.state.roomId}),n.username.length===0&&R.success("Enter your username"))},[n,(p=t.state)==null?void 0:p.roomId,s]),i.useEffect(()=>{if(r===O.DISCONNECTED&&!l.connected){l.connect();return}const f=sessionStorage.getItem("redirect")||!1;if(r===O.JOINED&&!f){const y=n.username;sessionStorage.setItem("redirect","true"),d(`/editor/${n.roomId}`,{state:{username:y}})}else r===O.JOINED&&f&&(sessionStorage.removeItem("redirect"),o(O.DISCONNECTED),l.disconnect(),l.connect())},[n,(m=t.state)==null?void 0:m.redirect,d,o,l,r]),e.jsx("div",{className:"w-full",children:e.jsxs("form",{onSubmit:b,className:"flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("label",{htmlFor:"roomId",className:"mb-1.5 block text-sm font-medium text-[#8b949e]",children:"Room ID"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",id:"roomId",name:"roomId",placeholder:"Enter room ID",className:"w-full rounded-md border border-[#30363d] bg-[#0d1117] px-3 py-2.5 text-[#c9d1d9] transition-colors placeholder:text-[#6e7681] focus:border-[#58a6ff] focus:outline-none",onChange:c,value:n.roomId}),e.jsx("button",{type:"button",onClick:a,className:"ml-2 flex items-center justify-center rounded-md border border-[#30363d] bg-[#0d1117] px-3 text-[#8b949e] transition-colors hover:bg-[#161b22] hover:text-[#c9d1d9]",title:"Generate new room ID",children:e.jsx(mt,{})})]})]}),e.jsxs("div",{className:"group relative",children:[e.jsx("label",{htmlFor:"username",className:"mb-1.5 block text-sm font-medium text-[#8b949e]",children:"Username"}),e.jsx("input",{type:"text",id:"username",name:"username",placeholder:"Enter your username",className:"w-full rounded-md border border-[#30363d] bg-[#0d1117] px-3 py-2.5 text-[#c9d1d9] transition-colors placeholder:text-[#6e7681] focus:border-[#58a6ff] focus:outline-none",onChange:c,value:n.username,ref:u})]}),e.jsx("button",{type:"submit",className:"mt-2 w-full rounded-md bg-[#238636] px-4 py-2.5 font-medium text-white transition-colors hover:bg-[#2ea043] focus:outline-none focus:ring-2 focus:ring-[#238636] focus:ring-offset-2 focus:ring-offset-[#0d1117]",children:"Join Session"})]})})};function ws(){return e.jsxs("div",{className:"flex min-h-screen flex-col bg-[#0d1117]",children:[e.jsx("div",{className:"absolute left-6 top-6",children:e.jsxs("h1",{className:"text-3xl font-bold text-white",children:[e.jsx("span",{className:"text-[#58a6ff]",children:"Code"}),"Collab"]})}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg border border-[#30363d] bg-[#161b22] p-8 shadow-xl",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold text-[#c9d1d9]",children:"Join Collaboration Session"}),e.jsx("p",{className:"mb-8 text-center text-[#8b949e]",children:"Enter a room ID and your username to start coding together in real-time"}),e.jsx(bs,{})]})})]})}const Cs=()=>e.jsxs(e.Fragment,{children:[e.jsx(Je,{children:e.jsxs(xn,{children:[e.jsx(me,{path:"/",element:e.jsx(ws,{})}),e.jsx(me,{path:"/editor/:roomId",element:e.jsx(gs,{})})]})}),e.jsx(Nn,{})," "]});function ys({children:t}){return e.jsx(vn,{children:e.jsx(Sn,{children:e.jsx(qn,{children:e.jsx(ns,{children:e.jsx(zn,{children:e.jsx(An,{children:e.jsx(Bn,{children:e.jsx(In,{children:t})})})})})})})})}Ye.createRoot(document.getElementById("root")).render(e.jsx(ys,{children:e.jsx(Cs,{})}));
